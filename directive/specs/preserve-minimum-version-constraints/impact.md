# Impact Analysis — Auto-Set Minimum Version Constraints in Release Script

## Modules/packages likely touched

### Core Implementation
- **`scripts/release.sh`**
  - Lines 119-145: Current constraint removal logic (REPLACE)
  - New section: Auto-set inter-package minimum version constraints
  - Logic to apply `>=NEW_VERSION` to slide-narrator, slide-lye, slide-tyler dependencies

### Affected Package Files (Updated by Script)
- **`packages/tyler/pyproject.toml`**
  - Line 33: `"slide-narrator"` → `"slide-narrator>=NEW_VERSION"`
  - Line 34: `"slide-lye"` → `"slide-lye>=NEW_VERSION"`

- **`packages/space-monkey/pyproject.toml`**
  - Line 29: `"slide-tyler"` → `"slide-tyler>=NEW_VERSION"`
  - Line 30: `"slide-narrator"` → `"slide-narrator>=NEW_VERSION"`

- **`packages/narrator/pyproject.toml`**
  - No changes (has no internal Slide dependencies)

- **`packages/lye/pyproject.toml`**
  - No changes (has no internal Slide dependencies)

- **`uv.lock`**
  - Auto-updated by script after constraint changes

### Testing
- **`test_release_process.sh`** (NEW or EXTEND)
  - Test that constraints are properly set after release
  - Verify external dependencies are not modified
  - Test constraint override scenarios

### Documentation
- **`scripts/README.md`**
  - Update release script documentation to explain auto-set behavior
  - Document the constraint management strategy

- **Package CHANGELOGs** (auto-generated by script)
  - Will reflect constraint changes in release commits

## Contracts to update (APIs, events, schemas, migrations)

### Public Contracts (PyPI Metadata)
- **Tyler package dependencies** (pyproject.toml published to PyPI)
  - Changes from: `slide-narrator` (any version)
  - Changes to: `slide-narrator>=X.Y.Z` (minimum version enforced)
  - Impact: Users must have narrator>=X.Y.Z when installing tyler

- **Space-monkey package dependencies**
  - Changes from: `slide-tyler`, `slide-narrator` (any version)
  - Changes to: `slide-tyler>=X.Y.Z`, `slide-narrator>=X.Y.Z`
  - Impact: Users must have compatible versions

### Internal Contracts
- **Release script behavior**
  - Old behavior: Remove all inter-package version constraints
  - New behavior: Set inter-package constraints to `>=NEW_VERSION`
  - Impact: Every release will update constraints automatically

- **Developer workflow**
  - Developers no longer need to manually manage inter-package constraints
  - Constraints are automatically managed by release script
  - Manual constraints will be overridden on each release

## Risks

### Security
- **Low risk**: No security implications
- This is a build-time script change affecting dependency metadata
- No runtime code changes
- No secrets or credentials involved

### Performance/Availability
- **Low risk**: Minimal performance impact
- Script execution time: +1-2 seconds (additional sed operations)
- PyPI installation: No performance change (same dependency resolution logic)
- Potential issue: If constraints are too strict, could prevent installations
  - Mitigation: Using `>=` (not `==`) allows future versions

### Data integrity
- **No risk**: No data or database changes
- Only affects package metadata in pyproject.toml files

### Compatibility Risk
- **Medium risk**: Could break existing user installations
  - Scenario: User has Tyler 3.1.0 + Narrator 3.0.0 (currently works)
  - After fix: Tyler 3.1.1 requires Narrator>=3.1.1
  - Impact: User must upgrade narrator when upgrading tyler
  - Mitigation: This is the desired behavior (prevents incompatible combinations)

- **Constraint conflict risk**: Low
  - Could conflict if user pins narrator to old version
  - Example: User has `slide-narrator==3.0.0` pinned
  - Impact: pip/uv will report conflict and fail installation
  - Mitigation: Clear error message from package manager; documented in CHANGELOG

### Rollback Risk
- **Low risk**: Easy to rollback
  - If script breaks, previous script version is in git
  - Can revert PR and release with old script
  - Published packages can't be unpublished, but new patch can fix

## Observability needs

### Logs
- **Release script output**
  - Current: Shows "✓ Package: constraint removed"
  - New: Show "✓ Package: constraint set to >=X.Y.Z"
  - Add: Echo statement for each constraint being set
  - Example: `echo "Setting slide-narrator>=$NEW_VERSION in tyler"`

### Metrics
- **Not applicable**: This is a development tool, not production code
- No runtime metrics needed

### Alerts
- **Not applicable**: No monitoring or alerting needed
- Release failures are human-driven and reviewed in PR

### Testing/Verification
- **Manual verification steps** (to be added to release checklist):
  1. After script runs, verify constraints in release branch:
     ```bash
     grep "slide-narrator\|slide-lye\|slide-tyler" packages/*/pyproject.toml
     ```
  2. Expected output should show `>=NEW_VERSION` for all inter-package deps
  3. Verify external packages unchanged:
     ```bash
     grep "litellm\|openai" packages/tyler/pyproject.toml
     ```
  4. Expected: External packages retain their original constraints

- **Automated testing** (nice to have):
  - Bash unit test for constraint-setting logic
  - Test with mock pyproject.toml files
  - Verify regex patterns match correctly
  
## Migration Plan

### Current Release PR (#76 - v3.1.1)
- **Status**: Already created with OLD script behavior
- **Issue**: Constraints were removed again
- **Options**:
  1. **Recommended**: Close PR #76, implement this fix, create new PR for 3.1.1
  2. Alternative: Manually fix PR #76 constraints, then implement script fix for 3.1.2

### Future Releases
- After this fix merges, all future releases automatically get correct constraints
- No manual intervention needed

### Backward Compatibility
- **Users on 3.1.0 or earlier**: Not affected (already released)
- **Users upgrading to 3.1.1+**: Will need compatible narrator/lye versions
- **Breaking change documentation**: Add to CHANGELOG for 3.1.1
  ```markdown
  ### ⚠️ Breaking Changes
  - Tyler now requires slide-narrator>=3.1.1 and slide-lye>=3.1.1
  - Space-monkey now requires slide-tyler>=3.1.1 and slide-narrator>=3.1.1
  - When upgrading, ensure all Slide packages are upgraded together
  ```

## Dependencies

### External Tools
- **sed**: Used for text replacement in pyproject.toml
  - Already used by current script
  - Available on all Unix-like systems (macOS, Linux)
  - No additional dependencies needed

- **git-cliff**: Already used for CHANGELOG generation
  - No changes to git-cliff usage

### Internal Dependencies
- None: This is a standalone script change
- Does not depend on any package code changes

## Timeline Impact

### Estimated Implementation Time
- Script modification: 1-2 hours
- Testing: 1 hour
- Documentation: 30 minutes
- **Total**: ~3-4 hours

### Impact on Current Release
- Blocks 3.1.1 release until fixed (or requires manual PR correction)
- Recommended: Implement fix first, then re-run release script

